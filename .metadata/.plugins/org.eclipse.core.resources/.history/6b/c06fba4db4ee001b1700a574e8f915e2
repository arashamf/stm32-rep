/**
  ******************************************************************************
  * @file    main.c
  * @author  Ac6
  * @version V1.0
  * @date    01-December-2013
  * @brief   Default main function.
  ******************************************************************************
*/

#include "delay_lib.h"
#include "stm32f4xx.h"
#include "MCU_ini.h"
#include "SPI_lib.h"
#include "UART_lib.h"


int main(void)
{

	// объявления для PLL
	uint8_t RCC_PLLM = 4; // предделитель PLL
	uint32_t  RCC_PLLN = 144 ; // умножитель PLL
	uint32_t  RCC_PLLP = 2; // постделитель PLL
	uint32_t RCC_PLLQ = 7;
	uint8_t CPU_WS = 2; //время задержки для работы с Flash памятью
	uint8_t status_PLL = PLL_ini (CPU_WS, RCC_PLLM, RCC_PLLN, RCC_PLLP, RCC_PLLQ); //инициализируем генератор PLL

	LEDS_ini () //инициализируем LED
	GPIO_SetBits (LED_Port, LED3_Pin);
	GPIO_ResetBits(LED_Port, LED4_Pin);
	GPIO_ResetBits(LED_Port, LED5_Pin);
	GPIO_ResetBits(LED_Port, LED6_Pin);

	UART1_ini_spl (BAUDRATE); //инициализируем UART1
	if (status_PLL)
		UART1_PutString("init PLL ok\r\n");
	delay_us (DELAY);
	init_CAN1 (); //инициализируем CAN1
	init_CAN2 (); //инициализируем CAN2
	UART1_PutString ("CAN gateway start\r\n");
	RCC_GetClocksFreq (&RCC_Clocks); //возвращает частоты SYSCLK, HCLK, PCLK1 и PCLK2
	sprintf (msg_UART_Tx, "%lu, %lu, %lu, %lu\r\n", RCC_Clocks.SYSCLK_Frequency, RCC_Clocks.HCLK_Frequency, RCC_Clocks.PCLK1_Frequency, RCC_Clocks.PCLK2_Frequency);
	UART1_PutString (msg_UART_Tx);
	GPIO_ResetBits (LED_GPIO_Port, LED_Pin);

}
